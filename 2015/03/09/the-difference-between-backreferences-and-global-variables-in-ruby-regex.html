<!DOCTYPE html><html lang="en"><head><meta charset="utf-8" /><meta content="IE=edge;chrome=1" http-equiv="X-UA-Compatible" /><title>The difference between back-references and global variables in Ruby regular expressions - Ragnarson Blog</title><meta content="summary" name="twitter:card" /><meta content="@ragnarsoncom" name="twitter:site" /><meta content="Ragnarson Blog" property="og:site_name" /><meta content="article" property="og:type" /><meta content="https://blog.ragnarson.com/2015/03/09/the-difference-between-backreferences-and-global-variables-in-ruby-regex.html" property="og:url" /><meta content="The difference between back-references and global variables in Ruby regular expressions" property="og:title" /><meta content="Regular expressions are widely used in the daily work of developers. For example, I can use the gsub method when I want to replace all the vowels in a given string with the underscore symbol:

&quot;here will be dragons&quot;.gsub(/([aeiouy])/, &quot;_&quot;)
=&gt; &quot;h_r_ w_ll b_ dr_g_ns&quot;

The question is how to wrap each matched vowel with the underscore. The first solution is to use the back-reference in a replacement argument:" property="og:description" /><meta content="Maciej Małecki" name="author" /><meta content="https://blog.ragnarson.com/images/blog-embed-c040007b71.png" property="og:image" /><meta content="@smefju" name="twitter:creator" /><link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" /><link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700,400italic&subset=latin,latin-ext" rel="stylesheet" type="text/css" /><link href="https://fonts.googleapis.com/css?family=Lato:400,700&subset=latin,latin-ext" rel="stylesheet" type="text/css" /><script type="application/ld+json">{"@context":"http://schema.org","@type":"Organization","name":"Ragnarson","url":"https://ragnarson.com"}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","name":"Ragnarson Blog","url":"https://blog.ragnarson.com"}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Person","name":"Maciej Małecki","image":"https://www.gravatar.com/avatar/6b844a73471cf2b060cb54d0b2f16161.jpg?s=144&d=mm"}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","headline":"The difference between back-references and global variables in Ruby regular expressions","url":"https://blog.ragnarson.com/2015/03/09/the-difference-between-backreferences-and-global-variables-in-ruby-regex.html","author":{"@type":"Person","name":"Maciej Małecki","image":"https://www.gravatar.com/avatar/6b844a73471cf2b060cb54d0b2f16161.jpg?s=144&d=mm"},"publisher":{"@type":"Organization","name":"Ragnarson","url":"https://ragnarson.com","logo":"https://blog.ragnarson.com/images/brand-c0054f1cec.svg"},"datePublished":"2015-03-09","dateModified":"2015-03-09"}</script><meta content="width=device-width, initial-scale=1.0" name="viewport" /><link href="/stylesheets/application-c0f3339569.css" rel="stylesheet" /><link href="/favicon-152-c0fe5a334d.png" rel="apple-touch-icon-precomposed" /><script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-11839548-2');
ga('set', 'allowAdFeatures', false);
ga('set', 'anonymizeIp', true);
ga('send', 'pageview');
</script>
</head><body><div class="container nav-container"><nav class="navbar navbar-dark navbar-toggleable-md"><button aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler navbar-toggler-right" data-target="#navbarResponsive" data-toggle="collapse" type="button"><i class="icon-menu"></i></button><a href="https://ragnarson.com" class="nav-brand navbar-logo"><img src="/images/brand-c0054f1cec.svg" title="Ragnarson Blog" width="220px" alt="Brand" /></a><div class="collapse navbar-collapse" id="navbarResponsive"><ul class="nav navbar-nav ml-auto"><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#">Why us</a><div class="dropdown-menu"><a href="https://ragnarson.com/our-story/" class="dropdown-item">Our story</a><a href="https://ragnarson.com/core-values/" class="dropdown-item">Core Values</a></div></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#">Services</a><div class="dropdown-menu"><a href="https://ragnarson.com/services/web-app-development/" class="dropdown-item">Web app development</a><a href="https://ragnarson.com/services/infrastructure-and-devops/" class="dropdown-item">Infrastructure and DevOps</a></div></li><li class="nav-item"><a href="https://ragnarson.com/case-studies/" class="nav-link">Case studies</a></li><li class="nav-item"><a href="https://ragnarson.com/community/" class="nav-link">Community</a></li><li class="nav-item"><a href="https://ragnarson.com/?utm_source=ragnarson&amp;utm_medium=blog&amp;utm_campaign=blog-header#contact" class="nav-link">Contact</a></li><li class="nav-item"><a href="/" class="active nav-link">Blog</a></li><li class="nav-item"><a href="http://jobs.ragnarson.com" class="nav-link">Jobs</a></li></ul></div></nav></div><div class="newsletter-show newsletter-container" id="js-box"><div class="newsletter-toggler"><i class="icon-chevron-right" id="js-arrow"></i></div><div class="newsletter-box"><div class="newsletter-popup"><div id="mc_embed_signup">
  <form action="//ragnarson.us10.list-manage.com/subscribe/post?u=6a4a4d00f989604300f83d3de&amp;id=6adadf2f44" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    <div id="mc_embed_signup_scroll">
      <label for="mce-EMAIL" class="newsletter-label">
        Sign up for our newsletter and get notifications about new articles on your email
      </label>

      <div class="row">
        <div class="three-thirds">
          <input type="email" value="" name="EMAIL" class="newsletter-input" id="mce-EMAIL" placeholder="Your email address" required>

          <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
          <div class="signup_hidden">
            <input type="text" name="b_6a4a4d00f989604300f83d3de_6adadf2f44" tabindex="-1" value="" class="one-half">
          </div>
        </div>

        <div class="mt-3 text-center">
          <input type="submit" value="Join our newsletter" name="subscribe" id="mc-embedded-subscribe" class="btn newsletter-btn">
        </div>
      </div>
    </div>
  </form>
</div>
</div></div></div><div id="main" role="main"><div class="article"><header><img src="https://www.gravatar.com/avatar/6b844a73471cf2b060cb54d0b2f16161.jpg?s=144&amp;d=mm" class="avatar" width="72px" size="72px" alt="6b844a73471cf2b060cb54d0b2f16161" /><div class="article-meta">March  9, 2015 - <a href="/authors/maciej-malecki.html">Maciej Małecki</a>  in <a href="/categories/development.html">development</a></div><h1 class="article-title"><a href="/2015/03/09/the-difference-between-backreferences-and-global-variables-in-ruby-regex.html">The difference between back-references and global variables in Ruby regular expressions</a></h1></header><div class="article-notice">This article was originally posted on the Shelly Cloud blog, our Ruby
platform as a service that we have decided to shut down on October 2015.</div><p>Regular expressions are widely used in the daily work of developers. For example, I can use the <a href="http://ruby-doc.org/core-2.2.0/String.html#method-i-gsub">gsub method</a> when I want to replace all the vowels in a given string with the underscore symbol:</p>
<pre class="highlight ruby"><code><span class="s2">"here will be dragons"</span><span class="p">.</span><span class="nf">gsub</span><span class="p">(</span><span class="sr">/([aeiouy])/</span><span class="p">,</span> <span class="s2">"_"</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="s2">"h_r_ w_ll b_ dr_g_ns"</span>
</code></pre>

<p>The question is how to wrap each matched vowel with the underscore. The first solution is to use the <strong>back-reference</strong> in a <em>replacement</em> argument:

<code>ruby
&quot;here will be dragons&quot;.gsub(/([aeiouy])/, &#39;_\1_&#39;)
=&gt; &quot;h_e_r_e_ w_i_ll b_e_ dr_a_g_o_ns&quot;
</code></p>

<p>Keep in mind that a back-reference needs an extra backslash if it occurs in double quotation marks. The second solution is to use a <strong>block</strong> instead of the <em>replacement</em> argument:</p>
<pre class="highlight ruby"><code><span class="s2">"here will be dragons"</span><span class="p">.</span><span class="nf">gsub</span><span class="p">(</span><span class="sr">/([aeiouy])/</span><span class="p">)</span> <span class="p">{</span> <span class="s2">"_</span><span class="si">#{</span><span class="vg">$1</span><span class="si">}</span><span class="s2">_"</span> <span class="p">}</span>
<span class="o">=&gt;</span> <span class="s2">"h_e_r_e_ w_i_ll b_e_ dr_a_g_o_ns"</span>
</code></pre>

<p>In this case, I use the <code>$1</code> global variable instead of the <code>\1</code> back-reference. The reason is that global variables, used within the <code>gsub</code> call, will not refer to the current match - they will refer to the previous one, or will be set to <code>nil</code> if there was no regular expression match before:</p>
<pre class="highlight ruby"><code><span class="s2">"dragons"</span><span class="p">.</span><span class="nf">gsub</span><span class="p">(</span><span class="sr">/(\w+)s/</span><span class="p">,</span> <span class="vg">$1</span><span class="p">)</span>
<span class="c1"># TypeError: no implicit conversion of nil into String</span>
<span class="c1"># from (pry):1:in `gsub'</span>

<span class="vg">$1</span>
<span class="o">=&gt;</span> <span class="kp">nil</span>

<span class="s2">"birds"</span><span class="p">.</span><span class="nf">gsub</span><span class="p">(</span><span class="sr">/(\w+)s/</span><span class="p">,</span> <span class="s1">'\1'</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="s2">"bird"</span>

<span class="s2">"dragons"</span><span class="p">.</span><span class="nf">gsub</span><span class="p">(</span><span class="sr">/(\w+)s/</span><span class="p">,</span> <span class="vg">$1</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="s2">"bird"</span>

<span class="vg">$1</span>
<span class="o">=&gt;</span> <span class="s2">"dragon"</span>
</code></pre>

<p>This example shows that even a small mistake in the code can cause strange behavior, which can be hard to discover and fix.</p>

<p>To summarize, use back-references for processing strings within the <code>gsub</code> method call. Choose global variables when using a block instead of a <em>replacement</em> argument, or if the regexp call is before manipulating with the result.</p>
<div class="work-with-us"><p>At Ragnarson we help companies deliver great products. We take care of development and deployment so that they can focus on growing the product and working with customers.</p><a class="btn" href="https://ragnarson.com/?utm_source=ragnarson&utm_medium=blog&utm_campaign=work-with-us#contact">Work with us</a></div><div class="article-comments"><div id="commento"></div>
<script src="https://cdn.commento.io/js/commento.js"></script>
</div></div><footer><div class="text--center"><a href="https://ragnarson.com/?utm_source=ragnarson&amp;utm_medium=blog&amp;utm_campaign=blog-footer"><img src="/images/ragnar-desk-c0d025368e.png" srcset="/images/ragnar-desk-c0d025368e.png 1x, /images/ragnar-desk-2x-c0332b062e.png 2x" alt="Ragnar desk" /></a></div></footer></div><script src="/javascripts/application-c0ec307bf9.js"></script></body></html>