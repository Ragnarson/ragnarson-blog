<!DOCTYPE html><html lang="en"><head><meta charset="utf-8" /><meta content="IE=edge;chrome=1" http-equiv="X-UA-Compatible" /><title>Hide your staging environment from Google - Ragnarson Blog</title><meta content="summary" name="twitter:card" /><meta content="@ragnarsoncom" name="twitter:site" /><meta content="Ragnarson Blog" property="og:site_name" /><meta content="article" property="og:type" /><meta content="https://blog.ragnarson.com/2013/11/15/hide-your-staging-environment-from-google.html" property="og:url" /><meta content="Hide your staging environment from Google" property="og:title" /><meta content="If you deploy your application to a staging environment, chances are that
it will eventually get picked up by Google and other search engines. This
is undesired for many reasons, from other people discovering your
unfinished work to
bad SEO from duplicate content." property="og:description" /><meta content="Grzesiek Kołodziejczyk" name="author" /><meta content="https://blog.ragnarson.com/images/blog-embed-c040007b71.png" property="og:image" /><meta content="@grkcodes" name="twitter:creator" /><link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" /><link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700,400italic&subset=latin,latin-ext" rel="stylesheet" type="text/css" /><link href="https://fonts.googleapis.com/css?family=Lato:400,700&subset=latin,latin-ext" rel="stylesheet" type="text/css" /><script type="application/ld+json">{"@context":"http://schema.org","@type":"Organization","name":"Ragnarson","url":"https://ragnarson.com"}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","name":"Ragnarson Blog","url":"https://blog.ragnarson.com"}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Person","name":"Grzesiek Kołodziejczyk","image":"https://www.gravatar.com/avatar/ebdeb6de770c069ff6f2b37780d2a340.jpg?s=144&d=mm"}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","headline":"Hide your staging environment from Google","url":"https://blog.ragnarson.com/2013/11/15/hide-your-staging-environment-from-google.html","author":{"@type":"Person","name":"Grzesiek Kołodziejczyk","image":"https://www.gravatar.com/avatar/ebdeb6de770c069ff6f2b37780d2a340.jpg?s=144&d=mm"},"publisher":{"@type":"Organization","name":"Ragnarson","url":"https://ragnarson.com","logo":"https://blog.ragnarson.com/images/brand-c0054f1cec.svg"},"datePublished":"2013-11-15","dateModified":"2013-11-15"}</script><meta content="width=device-width, initial-scale=1.0" name="viewport" /><link href="/stylesheets/application-c0f3339569.css" rel="stylesheet" /><link href="/favicon-152-c0fe5a334d.png" rel="apple-touch-icon-precomposed" /><script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-11839548-2');
ga('set', 'allowAdFeatures', false);
ga('set', 'anonymizeIp', true);
ga('send', 'pageview');
</script>
</head><body><div class="container nav-container"><nav class="navbar navbar-dark navbar-toggleable-md"><button aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler navbar-toggler-right" data-target="#navbarResponsive" data-toggle="collapse" type="button"><i class="icon-menu"></i></button><a href="https://ragnarson.com" class="nav-brand navbar-logo"><img src="/images/brand-c0054f1cec.svg" title="Ragnarson Blog" width="220px" alt="Brand" /></a><div class="collapse navbar-collapse" id="navbarResponsive"><ul class="nav navbar-nav ml-auto"><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#">Why us</a><div class="dropdown-menu"><a href="https://ragnarson.com/manifesto" class="dropdown-item">Manifesto</a><a href="https://ragnarson.com/team" class="dropdown-item">Team</a></div></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#">Services</a><div class="dropdown-menu"><a href="https://ragnarson.com/software-development" class="dropdown-item">Software Development</a><a href="https://ragnarson.com/fund" class="dropdown-item">Fund</a><a href="https://ragnarson.com/advisory" class="dropdown-item">Advisory</a></div></li><li class="nav-item"><a href="https://ragnarson.com/case-studies" class="nav-link">Case studies</a></li><li class="nav-item"><a href="https://ragnarson.com/?utm_source=ragnarson&amp;utm_medium=blog&amp;utm_campaign=blog-header#the-contact-form" class="nav-link">Contact</a></li><li class="nav-item"><a href="/" class="active nav-link">Blog</a></li><li class="nav-item"><a href="https://ragnarson.com/careers" class="nav-link">Careers</a></li></ul></div></nav></div><div class="newsletter-show newsletter-container" id="js-box"><div class="newsletter-toggler"><i class="icon-chevron-right" id="js-arrow"></i></div><div class="newsletter-box"><div class="newsletter-popup"><div id="mc_embed_signup">
  <form action="//ragnarson.us10.list-manage.com/subscribe/post?u=6a4a4d00f989604300f83d3de&amp;id=6adadf2f44" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    <div id="mc_embed_signup_scroll">
      <label for="mce-EMAIL" class="newsletter-label">
        Sign up for our newsletter and get notifications about new articles on your email
      </label>

      <div class="row">
        <div class="three-thirds">
          <input type="email" value="" name="EMAIL" class="newsletter-input" id="mce-EMAIL" placeholder="Your email address" required>

          <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
          <div class="signup_hidden">
            <input type="text" name="b_6a4a4d00f989604300f83d3de_6adadf2f44" tabindex="-1" value="" class="one-half">
          </div>
        </div>

        <div class="mt-3 text-center">
          <input type="submit" value="Join our newsletter" name="subscribe" id="mc-embedded-subscribe" class="btn newsletter-btn">
        </div>
      </div>
    </div>
  </form>
</div>
</div></div></div><div id="main" role="main"><div class="article"><header><img src="https://www.gravatar.com/avatar/ebdeb6de770c069ff6f2b37780d2a340.jpg?s=144&amp;d=mm" class="avatar" width="72px" size="72px" alt="Ebdeb6de770c069ff6f2b37780d2a340" /><div class="article-meta">November 15, 2013 - <a href="/authors/grzesiek-kolodziejczyk.html">Grzesiek Kołodziejczyk</a>  in <a href="/categories/development.html">development</a>, <a href="/categories/entrepreneurship.html">entrepreneurship</a></div><h1 class="article-title"><a href="/2013/11/15/hide-your-staging-environment-from-google.html">Hide your staging environment from Google</a></h1></header><div class="article-notice">This article was originally posted on the Shelly Cloud blog, our Ruby
platform as a service that we have decided to shut down on October 2015.</div><p>If you deploy your application to a staging environment, chances are that
it will eventually get picked up by Google and other search engines. This
is undesired for many reasons, from other people discovering your
unfinished work to
<a href="http://moz.com/learn/seo/duplicate-content">bad SEO from duplicate content</a>. </p>

<p><a href="http://www.robotstxt.org/robotstxt.html">robots.txt</a> is a file that
can be used to instruct search engine robots not to index certain paths of a
website. Ruby on Rails creates a robots.txt file in the public directory when
generating a new project, but since it is a static file, we can&#39;t make it work
for both the production and staging environments.</p>

<p>So, the first step is to remove that file from our repository.</p>

<p>Then, we can make Rails generate different content depending on the enviroment
it is in. While this can be done using a controller, a simpler way is to
create a <a href="http://rack.github.io/">Rack</a> app.</p>

<p>Create a <code>lib/robots_txt.rb</code> file with the following content:</p>
<pre class="highlight ruby"><code><span class="k">class</span> <span class="nc">RobotsTxt</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">call</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
    <span class="c1"># start building a new response</span>
    <span class="n">response</span> <span class="o">=</span> <span class="no">Rack</span><span class="o">::</span><span class="no">Response</span><span class="p">.</span><span class="nf">new</span>

    <span class="c1"># set content type to plain txt file</span>
    <span class="n">response</span><span class="p">[</span><span class="s1">'Content-Type'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'text/plain'</span>
    <span class="c1"># cache the response for one year, so that further requests won't hit</span>
    <span class="c1"># the application</span>
    <span class="n">response</span><span class="p">[</span><span class="s1">'Cache-Control'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'public, max-age=31557600'</span> <span class="c1"># cache for 1 year</span>

    <span class="c1"># if we're not in production env, set the content to disallow all robots</span>
    <span class="k">unless</span> <span class="no">Rails</span><span class="p">.</span><span class="nf">env</span><span class="p">.</span><span class="nf">production?</span>
      <span class="c1"># disallow access to the whole site (/) for all agents (*)</span>
      <span class="n">response</span><span class="p">.</span><span class="nf">write</span> <span class="s2">"User-agent: *</span><span class="se">\n</span><span class="s2">Disallow: /"</span>
    <span class="k">end</span>

    <span class="n">response</span><span class="p">.</span><span class="nf">finish</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>

<p>Finally, connect that app to the correct route in <code>config/routes.rb</code>:</p>
<pre class="highlight ruby"><code><span class="no">YourApp</span><span class="o">::</span><span class="no">Application</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">draw</span> <span class="k">do</span>
  <span class="n">get</span> <span class="s1">'/robots.txt'</span> <span class="o">=&gt;</span> <span class="no">RobotsTxt</span>
<span class="k">end</span>
</code></pre>

<p>When you deploy those changes, your app will serve an empty file when running
in the production environment, and disallow all robots from indexing your
site in any other environment.</p>

<p>If you want to lock down your staging environment even further, you can
<a href="/blog/2012/03/protecting-staging-environment-in-rack">use HTTP basic auth</a>.
This way all requests will have to be authenticated with a username and password.</p>
<div class="work-with-us"><p>At Ragnarson we help companies deliver great products. We take care of development and deployment so that they can focus on growing the product and working with customers.</p><a class="btn" href="https://ragnarson.com/?utm_source=ragnarson&utm_medium=blog&utm_campaign=work-with-us#contact">Work with us</a></div><div class="article-comments"><div id="commento"></div>
<script src="https://cdn.commento.io/js/commento.js"></script>
</div></div><footer><div class="text--center"><a href="https://ragnarson.com/?utm_source=ragnarson&amp;utm_medium=blog&amp;utm_campaign=blog-footer"><img src="/images/ragnar-desk-c0d025368e.png" srcset="/images/ragnar-desk-c0d025368e.png 1x, /images/ragnar-desk-2x-c0332b062e.png 2x" alt="Ragnar desk" /></a></div></footer></div><script src="/javascripts/application-c0ec307bf9.js"></script></body></html>