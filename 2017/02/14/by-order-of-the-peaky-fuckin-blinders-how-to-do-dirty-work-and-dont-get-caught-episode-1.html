<!DOCTYPE html><html lang="en"><head><meta charset="utf-8" /><meta content="IE=edge;chrome=1" http-equiv="X-UA-Compatible" /><title>"By order of the Peaky fuckin' Blinders" - how to do dirty work and don’t get caught - episode 1 - Ragnarson Blog</title><meta content="summary" name="twitter:card" /><meta content="@ragnarsoncom" name="twitter:site" /><meta content="Ragnarson Blog" property="og:site_name" /><meta content="article" property="og:type" /><meta content="https://blog.ragnarson.com/2017/02/14/by-order-of-the-peaky-fuckin-blinders-how-to-do-dirty-work-and-dont-get-caught-episode-1.html" property="og:url" /><meta content=""By order of the Peaky fuckin' Blinders" - how to do dirty work and don’t get caught - episode 1" property="og:title" /><meta content="“Everyone's a whore, Grace. We just sell different parts of ourselves”

Thomas Shelby

Life is not always nice, simple and easy. Sometimes is more complex. Sometimes you are its lawful citizen. Sometimes you break the rules and do some dirty, shady things. Sometimes you are a copper. Sometimes you are a scoundrel. One day you are writing an API and taking care of its protection. Another day you are receiving the task to use someone else API without permission. It is not a thing you should do, but in startups game sometimes you have to do whatever it takes.  It is possible to do that if the API is protected by basic auth. I will help you to do it right and won’t be caught." property="og:description" /><meta content="Piotr Misiurek" name="author" /><meta content="https://blog.ragnarson.com/2017/02/14/by-order-of-the-peaky-fuckin-blinders-how-to-do-dirty-work-and-dont-get-caught-episode-1/cover-c03bb75ecf.png" property="og:image" /><link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" /><link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700,400italic&subset=latin,latin-ext" rel="stylesheet" type="text/css" /><link href="https://fonts.googleapis.com/css?family=Lato:400,700&subset=latin,latin-ext" rel="stylesheet" type="text/css" /><script type="application/ld+json">{"@context":"http://schema.org","@type":"Organization","name":"Ragnarson","url":"https://ragnarson.com"}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","name":"Ragnarson Blog","url":"https://blog.ragnarson.com"}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Person","name":"Piotr Misiurek","image":"https://www.gravatar.com/avatar/5122e54437a4b89911623dfbe9a2f3c4.jpg?s=144&d=mm"}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","headline":"\"By order of the Peaky fuckin' Blinders\" - how to do dirty work and don’t get caught - episode 1","url":"https://blog.ragnarson.com/2017/02/14/by-order-of-the-peaky-fuckin-blinders-how-to-do-dirty-work-and-dont-get-caught-episode-1.html","author":{"@type":"Person","name":"Piotr Misiurek","image":"https://www.gravatar.com/avatar/5122e54437a4b89911623dfbe9a2f3c4.jpg?s=144&d=mm"},"publisher":{"@type":"Organization","name":"Ragnarson","url":"https://ragnarson.com","logo":"https://blog.ragnarson.com/images/brand-c0054f1cec.svg"},"datePublished":"2017-02-14","dateModified":"2017-02-14","image":"https://blog.ragnarson.com/2017/02/14/by-order-of-the-peaky-fuckin-blinders-how-to-do-dirty-work-and-dont-get-caught-episode-1/cover-c03bb75ecf.png"}</script><meta content="width=device-width, initial-scale=1.0" name="viewport" /><link href="/stylesheets/application-c0f3339569.css" rel="stylesheet" /><link href="/favicon-152-c0fe5a334d.png" rel="apple-touch-icon-precomposed" /><script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-11839548-2');
ga('set', 'allowAdFeatures', false);
ga('set', 'anonymizeIp', true);
ga('send', 'pageview');
</script>
</head><body><div class="container nav-container"><nav class="navbar navbar-dark navbar-toggleable-md"><button aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler navbar-toggler-right" data-target="#navbarResponsive" data-toggle="collapse" type="button"><i class="icon-menu"></i></button><a href="https://ragnarson.com" class="nav-brand navbar-logo"><img src="/images/brand-c0054f1cec.svg" title="Ragnarson Blog" width="220px" alt="Brand" /></a><div class="collapse navbar-collapse" id="navbarResponsive"><ul class="nav navbar-nav ml-auto"><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#">Why us</a><div class="dropdown-menu"><a href="https://ragnarson.com/our-story/" class="dropdown-item">Our story</a><a href="https://ragnarson.com/core-values/" class="dropdown-item">Core Values</a></div></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#">Services</a><div class="dropdown-menu"><a href="https://ragnarson.com/services/web-app-development/" class="dropdown-item">Web app development</a><a href="https://ragnarson.com/services/infrastructure-and-devops/" class="dropdown-item">Infrastructure and DevOps</a></div></li><li class="nav-item"><a href="https://ragnarson.com/case-studies/" class="nav-link">Case studies</a></li><li class="nav-item"><a href="https://ragnarson.com/community/" class="nav-link">Community</a></li><li class="nav-item"><a href="https://ragnarson.com/?utm_source=ragnarson&amp;utm_medium=blog&amp;utm_campaign=blog-header#contact" class="nav-link">Contact</a></li><li class="nav-item"><a href="/" class="active nav-link">Blog</a></li><li class="nav-item"><a href="http://jobs.ragnarson.com" class="nav-link">Jobs</a></li></ul></div></nav></div><div class="newsletter-show newsletter-container" id="js-box"><div class="newsletter-toggler"><i class="icon-chevron-right" id="js-arrow"></i></div><div class="newsletter-box"><div class="newsletter-popup"><div id="mc_embed_signup">
  <form action="//ragnarson.us10.list-manage.com/subscribe/post?u=6a4a4d00f989604300f83d3de&amp;id=6adadf2f44" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    <div id="mc_embed_signup_scroll">
      <label for="mce-EMAIL" class="newsletter-label">
        Sign up for our newsletter and get notifications about new articles on your email
      </label>

      <div class="row">
        <div class="three-thirds">
          <input type="email" value="" name="EMAIL" class="newsletter-input" id="mce-EMAIL" placeholder="Your email address" required>

          <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
          <div class="signup_hidden">
            <input type="text" name="b_6a4a4d00f989604300f83d3de_6adadf2f44" tabindex="-1" value="" class="one-half">
          </div>
        </div>

        <div class="mt-3 text-center">
          <input type="submit" value="Join our newsletter" name="subscribe" id="mc-embedded-subscribe" class="btn newsletter-btn">
        </div>
      </div>
    </div>
  </form>
</div>
</div></div></div><div id="main" role="main"><div class="article"><header><img src="https://www.gravatar.com/avatar/5122e54437a4b89911623dfbe9a2f3c4.jpg?s=144&amp;d=mm" class="avatar" width="72px" size="72px" alt="5122e54437a4b89911623dfbe9a2f3c4" /><div class="article-meta">February 14, 2017 - <a href="/authors/piotr-misiurek.html">Piotr Misiurek</a>  in <a href="/categories/development.html">development</a>, <a href="/categories/entrepreneurship.html">entrepreneurship</a></div><h1 class="article-title"><a href="/2017/02/14/by-order-of-the-peaky-fuckin-blinders-how-to-do-dirty-work-and-dont-get-caught-episode-1.html">"By order of the Peaky fuckin' Blinders" - how to do dirty work and don’t get caught - episode 1</a></h1></header><img src='/2017/02/14/by-order-of-the-peaky-fuckin-blinders-how-to-do-dirty-work-and-dont-get-caught-episode-1/cover-c03bb75ecf.png'/><blockquote>
<p>“Everyone&#39;s a whore, Grace. We just sell different parts of ourselves”</p>
</blockquote>

<p><em>Thomas Shelby</em></p>

<p>Life is not always nice, simple and easy. Sometimes is more complex. Sometimes you are its lawful citizen. Sometimes you break the rules and do some dirty, shady things. Sometimes you are a copper. Sometimes you are a scoundrel. One day you are writing an API and taking care of its protection. Another day you are receiving the task to use someone else API without permission. It is not a thing you should do, but in startups game sometimes you have to do whatever it takes.  It is possible to do that if the API is protected by basic auth. I will help you to do it right and won’t be caught.</p>

<p></p>

<h2>Draw the map to the princes&#39; bedroom</h2>

<blockquote>
<p>&quot;Do you have a map? Because I&#39;m not going to be able to find my way in the dark. You see, at midnight, I&#39;m going to leave my wing and I&#39;m going to come find you. And I&#39;m going to turn the handle of your bedroom door without making a sound and none of the maids will know.&quot;</p>
</blockquote>

<p><em>Thomas Shelby</em></p>

<p>Every single day hundreds or even thousands of new mobile apps are released. The majority of them are using APIs to get some data. Like information about events nearby or trains timetables. Let’s assume that we really need such data. And there is no free nor even paid sources of the data. But thank God, there is an app for that (that is using this data). Let use its API.</p>

<p>The first thing we have to do is to figure out how the API works. How requests and responses look like. To achieve this goal we have to see how the app is communicating with the API. The things will be required:</p>

<ul>
<li>To establish a proxy on our machine that will allow us to see communication between the app and the API</li>
<li>To configure our iPhone to use this proxy</li>
</ul>

<h3>Establish the proxy</h3>

<p>There are many ready to use proxy solutions on the market. Like <a href="https://portswigger.net/burp/">Burp Suite</a> or <a href="https://mitmproxy.org/">mitmproxy</a>. We will use the second one because it works from a console. It will make this article to look more geeky and professional.</p>

<p>Mitmproxy is written in Python, so we will install it via Python’s package manager PIP:</p>
<pre class="highlight plaintext"><code>pip install mitmproxy
</code></pre>

<p>If you don’t have Python installed on your machine you can <a href="https://www.python.org/downloads/">download it from here</a>. It doesn’t matter if you install Python-2.7 or Python-3.5. Just pick one of them.</p>

<p>If you need more info or you have any problems during mitmproxy installation then, please follow the <a href="http://docs.mitmproxy.org/en/stable/install.html">installation guide</a>.</p>

<p>After installation, you can call mitmproxy from the console
<code>
mitmproxy
</code>
As you can see in the left bottom corner the proxy is available at port 8080. Now it is time to…</p>

<h3>Configure your iPhone to use our proxy</h3>

<p>Let’s start with the Captain Obvious: connect your iPhone to the same wi-fi network as your computer.</p>

<p>The second thing is to check your computer&#39;s internal network IP. You can find it in your network preferences.
<img src="/2017/02/14/by-order-of-the-peaky-fuckin-blinders-how-to-do-dirty-work-and-dont-get-caught-episode-1/network-c0d2fed30c.png" alt="MacOS network preferences" /></p>

<p>Now you have to set up your iPhone to use this proxy. Go to <code>Settings -&gt; Wi-Fi</code> then go to <code>current network details</code>. And the bottom there are <code>proxy settings</code>. Click the manual tab and provide proxy server IP you got in the previous step and its port which is 8080.
And it works! Now you can go to the iPhone browser and visit any page. Then you will see the request in mitmproxy. Use arrows to navigate on requests list. Press enter to see the request details. Press q to go back to the list.</p>

<p><img src="/2017/02/14/by-order-of-the-peaky-fuckin-blinders-how-to-do-dirty-work-and-dont-get-caught-episode-1/mitmproxy-c075795fed.png" alt="Mitmproxy in action" /></p>

<h3>The SSL traffic</h3>

<p>You can see some cases when the proxy it not working. Some websites or apps are not working. The data is not loaded for them and you can’t see their request in proxy logs.</p>

<p>The reason is simple. The SSL clients don’t trust our proxy. To solve that issue we have to install mitmproxy CA certificates on the phone. To do this open web browser in your iPhone and visit special mitmproxy page: <a href="http://mitm.it">http://mitm.it</a>. Then click the icon of your platform, you will be asked to confirm certificate installation. And it is done. Now all https traffic is working and you can see it on the proxy.</p>

<h2>What we can see here</h2>

<p>It is time to use the app that is using the API that we are interested in. Make some requests and see their details in mitmproxy.</p>

<p>The most important parts are:</p>

<ul>
<li>which URLs are requested for each action</li>
<li>how does each request look like?</li>
<li>which HTTP method is in use</li>
<li>how the params look like</li>
<li>how the body looks like</li>
<li>which headers are sent with the request? What are their values? You would like to send the same headers with your requests. Special interesting will be headers with API key or user ID. If you find them and the API use only basic authentication you are at home. You can save them and use in your future requests. If API is protected with a more sophisticated protocol like OAuth then I’m not able to help you. Find another API or article :)</li>
</ul>

<p>You can also see how the response looks like. Which format is in use? How is data organized? Etc. This knowledge will be useful to write good parsers on your site.</p>

<p>Now we have all required info: how the requests should look like? Which headers are sent?
You are ready to write your own scraper of this API. In the next episode, we will talk about things you need to focus on to do it right and won’t be caught.</p>
<div class="work-with-us"><p>At Ragnarson we help companies deliver great products. We take care of development and deployment so that they can focus on growing the product and working with customers.</p><a class="btn" href="https://ragnarson.com/?utm_source=ragnarson&utm_medium=blog&utm_campaign=work-with-us#contact">Work with us</a></div><div class="article-comments"><div id="commento"></div>
<script src="https://cdn.commento.io/js/commento.js"></script>
</div></div><footer><div class="text--center"><a href="https://ragnarson.com/?utm_source=ragnarson&amp;utm_medium=blog&amp;utm_campaign=blog-footer"><img src="/images/ragnar-desk-c0d025368e.png" srcset="/images/ragnar-desk-c0d025368e.png 1x, /images/ragnar-desk-2x-c0332b062e.png 2x" alt="Ragnar desk" /></a></div></footer></div><script src="/javascripts/application-c0ec307bf9.js"></script></body></html>